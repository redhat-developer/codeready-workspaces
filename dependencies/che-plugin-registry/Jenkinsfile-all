#!/usr/bin/env groovy

// build params
//extensions - comma separated list of extensions

node {
    stage 'build extensions'
    def extensions = "${extensions}"

    // key value map for
    def jobs = [:]


    extensionKeyValues.each { extension ->
        def buildjob = build job: 'vscode-extensions-packaging', parameters: [ string(name: 'extensionPath', value: extension.split("|")[1])]
        jobs.put(extension.split("|")[0], buildjob)
    }

    jobs.each { fileLocation, job ->
        copyArtifacts(projectName: 'vscode-extensions-packaging', selector: specific("${job.number}"))
    }

    sh "tar -cvf vscode-extensions-vsix.tar ."


    // TODO deploy artifact to pkgs.devel?

    archiveArtifacts artifacts: '*.tar', fingerprint: true
}
